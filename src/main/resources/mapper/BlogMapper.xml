<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chason.blog.mapper.BlogMapper">
    <resultMap id="BaseResultMap" type="com.chason.blog.entity.Blog">

        <id column="blog_id" jdbcType="INTEGER" property="blogId"/>
        <result column="blog_title" jdbcType="VARCHAR" property="blogTitle"/>
        <result column="blog_status" jdbcType="CHAR" property="blogStatus"/>
        <result column="content_type" jdbcType="TINYINT" property="contentType"/>
        <result column="blog_content" jdbcType="LONGVARCHAR" property="blogContent"/>
        <result column="is_reproduced" jdbcType="TINYINT" property="isReproduced"/>
        <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="is_deleted" jdbcType="TINYINT" property="isDeleted"/>
    </resultMap>

    <sql id="Base_Column_List">
    blog_id, blog_title, blog_status,blog_content, content_type, is_reproduced, modify_time, create_time, is_deleted
  </sql>

    <insert id="insertAndGetId" keyProperty="blogId" keyColumn="blog_id" useGeneratedKeys="true">

        <selectKey resultType="int" order="AFTER" keyProperty="blogId">
            SELECT LAST_INSERT_ID() as blogId
        </selectKey>

        INSERT INTO
        blog(blog_title,blog_content,content_type,create_time,modify_time)
        VALUES
        (#{blogTitle},#{blogContent},#{contentType},#{createTime},#{modifyTime})
    </insert>

    <select id="searchByTitle">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        blog
        WHERE
        blog_titie LIKE CONCAT('%',#{searchKey},'%')
        LIMIT #{rowBounds.offset},#{rowBounds.limit}
    </select>

    <select id="selectBlogList" resultMap="BaseResultMap" parameterType="org.apache.ibatis.session.RowBounds">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        blog
        ORDER BY modify_time DESC
        <if test="offset != null and limit != null">
            LIMIT #{offset},#{limit}
        </if>
    </select>


    <select id="searchKeyCount" parameterType="java.lang.String">
        SELECT
            count(*)
        FROM
          blog
        WHERE
         blog_titie LIKE CONCAT('%',#{searchKey},'%')
    </select>
</mapper>